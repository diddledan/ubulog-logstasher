input {
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-main.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-a*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-a.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-b*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-b.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-c*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-c.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-d*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-d.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-e*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-e.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-f*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-f.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-g*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-g.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-h*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-h.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-i*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-i.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-j*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-j.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-k*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-k.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-l*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-l.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-m*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-m.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-n*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-n.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-o*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-o.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-p*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-p.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-q*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-q.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-r*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-r.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-s*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-s.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-t*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-t.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-u*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-u.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-v*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-v.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-w*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-w.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-x*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-x.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-y*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-y.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
	file {
		path => [ "/var/lib/ubuntu-chatlogs/spool/#ubuntu-z*/*" ]
		start_position => beginning
		sincedb_path => "/var/lib/ubuntu-chatlogs/chatlogs-ubuntu-z.sincedb"
		codec => plain {
			charset => "UTF-8"
		}
	}
}

filter {
	grok {
		match => [ "path", "%{GREEDYDATA}/#%{DATA:channel}\.%{YEAR:year}-%{MONTHNUM2:month}-%{MONTHDAY:day}$" ]
		add_field => { server => "chat.freenode.org" }
		remove_field => "path"
	}
	grok {
		match => [ "message", "^(\[%{HOUR:hour}:%{MINUTE:minute}\]%{SPACE})?<%{DATA:nick}>%{SPACE}%{GREEDYDATA:text}" ]
		add_field => { action => "message" }
	}
	if ![action] {
		grok {
			match => [ "message", "^(\[%{HOUR:hour}:%{MINUTE:minute}\]%{SPACE})?(===|\*)%{SPACE}%{NOTSPACE:by} sets mode \+%{GREEDYDATA:mode}" ]
			add_field => { action => "addmode" }
		}
	}
	if ![action] {
		grok {
			match => [ "message", "^(\[%{HOUR:hour}:%{MINUTE:minute}\]%{SPACE})?(===|\*)%{SPACE}%{NOTSPACE:by} sets mode -%{GREEDYDATA:mode}" ]
			add_field => { action => "delmode" }
		}
	}
	if ![action] {
		grok {
			match => [ "message", "^(\[%{HOUR:hour}:%{MINUTE:minute}\]%{SPACE})?(===|\*)%{SPACE}mode/#%{NOTSPACE}%{SPACE}\[\+%{DATA:mode}\]%{SPACE}by %{NOTSPACE:by}" ]
			add_field => { action => "addmode" }
		}
	}
	if ![action] {
		grok {
			match => [ "message", "^(\[%{HOUR:hour}:%{MINUTE:minute}\]%{SPACE})?(===|\*)%{SPACE}mode/#%{NOTSPACE}%{SPACE}\[-%{DATA:mode}\]%{SPACE}by %{NOTSPACE:by}" ]
			add_field => { action => "delmode" }
		}
	}
	if ![action] {
		grok {
			match => [ "message", "^(\[%{HOUR:hour}:%{MINUTE:minute}\]%{SPACE})?(===|\*)%{SPACE}%{NOTSPACE:nick} was kicked off #%{NOTSPACE} by %{NOTSPACE:by}%{SPACE}%{GREEDYDATA:reason}" ]
			add_field => { action => "kick" }
		}
	}
	if ![action] {
		grok {
			match => [ "message", "^(\[%{HOUR:hour}:%{MINUTE:minute}\]%{SPACE})?(===|\*)%{SPACE}%{NOTSPACE:oldnick} is now known as %{NOTSPACE:nick}" ]
			add_field => { action => "nick" }
		}
	}
	if ![action] {
		grok {
			match => [ "message", "^(\[%{HOUR:hour}:%{MINUTE:minute}\]%{SPACE})?(===|\*)%{SPACE}%{NOTSPACE:nick} changed the topic of #%{NOTSPACE} to %{GREEDYDATA:topic}" ]
			add_field => { action => "topic" }
		}
	}
	if ![action] {
		grok {
			match => [ "message", "^(\[%{HOUR:hour}:%{MINUTE:minute}\]%{SPACE})?(===|\*)%{SPACE}%{NOTSPACE:nick} %{GREEDYDATA:text}$" ]
			add_field => { action => "action" }
		}
	}

	if [hour] !~ /\d\d/ {
		mutate { add_field => { "hour" => "00" } }
	}
	if [minute] !~ /\d\d/ {
		mutate { add_field => { "minute" => "00" } }
	}
	if [year] and [month] and [day] and [hour] and [minute] {
		mutate {
			add_field => {
				"grokdate" => "%{year}/%{month}/%{day} %{hour}:%{minute} +0000"
			}
		}
	}
	mutate {
		remove_field => [ "year", "month", "day", "hour", "minute" ]
	}
	if [grokdate] {
		date {
			match => [ "grokdate", "YYYY/MM/dd HH:mm Z" ]
			remove_field => [ "grokdate" ]
		}
	}
}